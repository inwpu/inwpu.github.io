<div class="footer">
    <% if(path != 'index.html') { %>
        <span>
            <%= theme.footerLink.info %>

            <% for (name in theme.footerLink) { %>
                <% if(name != 'info') { %>
                    / <a href="<%- url_for(theme.footerLink[name]) %>"> <%= name %> </a>
                <% } %>

            <% } %>
        </span>

    <% } %>
</div>

<% if(path == 'index.html' && (theme.indexInfo.allWordCount || theme.indexInfo.allViewCount)){ %>
<div class="footer-last-without-line">
    <% if(theme.indexInfo.allWordCount) { %>
        <span>本站总字数：<%= totalcount(site) %></span>
    <% } %>
    <% if(theme.indexInfo.allWordCount && theme.indexInfo.allViewCount) { %>
    <div class="footer-last-span-right">
        <% } else if(!theme.indexInfo.allWordCount && theme.indexInfo.allViewCount) { %>
        <div>
            <% } %>
            <% if(theme.indexInfo.allViewCount) { %>
                <span id="busuanzi_container_site_pv" class="">
                    本站总访问：<span id="busuanzi_value_site_pv"></span>次
                </span>
        </div>
        <% } %>
    </div>
    <% } %>

    <!--这是指一条线往下的内容-->
    <div class="footer-last">
        <% if(path == 'index.html'){ %>
            <% if(theme.index.footer != null || theme.index.footer != "") { %>
                <% if(theme.index.footer.length > "Email:".length && theme.index.footer.substring(0, 6) == "Email:") { %>
                    <% var email = theme.index.footer.substring(6, theme.index.footer.length) %>
                    <span class="index-footer-last-span">Email:<%- mail_to(email) %></span>
                <% } else { %>
                    <span class="index-footer-last-span"><%= theme.index.footer %></span>
                <% } %>
            <% } %>
        <% } else { %>
            <span><%= theme.post.footer %></span>
            <% if(theme.post.themeInfo) { %>
                <span class="footer-last-span-right"><i>本站由<a href="https://hexo.io/zh-cn/index.html">Hexo</a>驱动｜使用<a href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>主题</i></span>
            <% } %>
        <% } %>
    </div>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
            data-cf-beacon='{"token": "e5317d9548244f8a9c52f472cfcea521"}'></script>
    <!-- End Cloudflare Web Analytics -->
    <!-- 站点运行时间模块（所有页面都显示） -->
    <div id="site-runtime">
        本人已坚强开机运行 <span id="runtime-text"></span> <span id="heartbeat">❤️</span>
    </div>

    <style>
        #site-runtime {
            text-align: center;
            font-size: 14px;
            margin-top: 20px;
            color: #888;
        }

        #heartbeat {
            display: inline-block;
            color: red;
            font-size: 16px;
            animation: none;
            transform-origin: center;
        }

        @keyframes beat {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1); }
        }
    </style>

    <script>
        const startTime = new Date("2000-10-29T00:00:00"); // ← 替换为你建站时间
        function updateRuntime() {
            const now = new Date();
            const diff = now - startTime;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            const timeStr = `${days} 天 ${hours} 时 ${minutes} 分 ${seconds} 秒`;
            document.getElementById("runtime-text").innerText = timeStr;

            const heart = document.getElementById("heartbeat");
            heart.style.animation = "beat 0.3s ease";
            setTimeout(() => {
                heart.style.animation = "none";
            }, 300);
        }
        updateRuntime();
        setInterval(updateRuntime, 1000);
    </script>

    <% if(theme.cdn.enable) { %>
        <% if(theme.cdn.choose == "aliyun") { %>
            <%- js('https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/highlight.min.js') %>
            <%- js('https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js') %>

            <%- js('js/randomHeaderContent.js') %>
            <!--回到顶部按钮-->
            <% if(theme.tool.returnToTop) { %>
                <%- js('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js') %>
                <%- js('https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/returnToTop.js') %>
            <% } %>

            <!--目录-->
            <% if(theme.tool.leftToc) { %>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
                <%- js('https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/toc.js') %>
            <% } %>
        <% } else if(theme.cdn.choose == "zzko") { %>
            <%- js('https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js') %>
            <%- js('https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js') %>

            <%- js('https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/randomHeaderContent.js') %>
            <!--回到顶部按钮-->
            <% if(theme.tool.returnToTop) { %>
                <%- js('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js') %>
                <%- js('https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/returnToTop.js') %>
            <% } %>

            <!--目录-->
            <% if(theme.tool.leftToc) { %>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
                <%- js('https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/toc.js') %>
            <% } %>
        <% } else if(theme.cdn.choose == "jsdelivr") { %>
            <%- js('https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js') %>
            <%- js('https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js') %>

            <%- js('https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/randomHeaderContent.js') %>
            <!--回到顶部按钮-->
            <% if(theme.tool.returnToTop) { %>
                <%- js('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js') %>
                <%- js('https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/returnToTop.js') %>
            <% } %>

            <!--目录-->
            <% if(theme.tool.leftToc) { %>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
                <%- js('https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/toc.js') %>
            <% } %>
        <% } else if(theme.cdn.choose == "unpkg") { %>
            <%- js('https://npm.onmicrosoft.cn/hexo-theme-a4@latest/source/js/highlight.min.js') %>
            <%- js('https://npm.onmicrosoft.cn/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js') %>

            <%- js('https://npm.onmicrosoft.cn/hexo-theme-a4@latest/source/js/randomHeaderContent.js') %>
            <!--回到顶部按钮-->
            <% if(theme.tool.returnToTop) { %>
                <%- js('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js') %>
                <%- js('https://npm.onmicrosoft.cn/hexo-theme-a4@latest/source/js/returnToTop.js') %>
            <% } %>

            <!--目录-->
            <% if(theme.tool.leftToc) { %>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
                <%- js('https://npm.onmicrosoft.cn/hexo-theme-a4@latest/source/js/toc.js') %>
            <% } %>
        <% } %>
    <% } else { %>
        <%- js('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js') %>
        <!--目录-->
        <% if(theme.tool.leftToc) { %>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
            <%- js('js/toc.js') %>
        <% } %>

        <%- js('js/randomHeaderContent.js') %>
        <!--回到顶部按钮-->
        <% if(theme.tool.returnToTop) { %>
            <%- js('js/returnToTop.js') %>
        <% } %>

        <% if(theme.tool.returnToTop) { %>
            <%- js('js/returnToLastPage.js') %>
        <% } %>

    <% } %>


    <%- js('js/lightgallery/lightgallery.umd.min.js') %>

    <%- js('js/lightgallery/plugins/lg-thumbnail.umd.min.js') %>

    <%- js('js/lightgallery/plugins/lg-fullscreen.umd.min.js') %>
    <%- js('js/lightgallery/plugins/lg-autoplay.umd.min.js') %>
    <%- js('js/lightgallery/plugins/lg-zoom.umd.min.js') %>
    <%- js('js/lightgallery/plugins/lg-rotate.umd.min.js') %>
    <%- js('js/lightgallery/plugins/lg-paper.umd.min.js') %>
    <!-- 🌐 访客信息浮动框（玻璃拟态 + 可折叠） -->
    <div id="site-stats-float" class="glass visible">
        <ul>
            <li>📄 文章数目：<%= site.posts.length %></li>
            <li>👥 本站访客数：<span id="busuanzi_value_site_uv">加载中...</span></li>
            <li>📊 总浏览量：<span id="busuanzi_value_site_pv">加载中...</span></li>
            <li>🆔 访客识别码：<span id="visitor-id">加载中...</span></li>
            <li>⏱ 页面停留：<span id="stay-time">0 秒</span></li>
            <li>🌐 IP：<span id="ip">加载中...</span></li>
            <li>🌍 国家：<span id="country">加载中...</span></li>
            <li>🏙 城市：<span id="city">加载中...</span></li>
            <li>💼 运营商：<span id="org">加载中...</span></li>
            <li>💻 系统：<span id="os">加载中...</span></li>
            <li>🌐 浏览器：<span id="browser">加载中...</span></li>
            <li>📱 设备：<span id="device">加载中...</span></li>
            <li>⏰ 当前时间：<span id="nowtime">加载中...</span></li>
            <li>📅 页面更新：<%= new Date().toLocaleString() %></li>
        </ul>
    </div>
</div>
<!-- 💄 样式 -->
<style>
    #site-stats-float {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 14px 18px;
        font-size: 13px;
        color: #222;
        box-shadow: 0 0 10px rgba(0,0,0,0.15);
        z-index: 9999;
        line-height: 1.6;
        max-width: 300px;
    }
    #site-stats-float li {
        list-style: none;
    }
    /* 🌫️ 毛玻璃玻璃拟态风格 */
    #site-stats-float.glass {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 16px 20px;
        max-width: 300px;
        font-size: 13px;
        border-radius: 16px;
        backdrop-filter: blur(12px);
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        color: #222;
        z-index: 9999;
        line-height: 1.6;
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    #site-stats-float ul {
        padding: 0;
        margin: 0;
    }
    #site-stats-float li {
        list-style: none;
        margin-bottom: 6px;
    }
</style>


<!-- 🚀 脚本 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script>
    // UUID
    function generateUUID() {
        return 'xxxxxx-xxxxxx'.replace(/[x]/g, () =>
            (Math.random() * 36 | 0).toString(36)
        );
    }

    function getVisitorID() {
        let id = localStorage.getItem('visitor_uuid');
        if (!id) {
            id = generateUUID();
            localStorage.setItem('visitor_uuid', id);
        }
        return id;
    }

    document.getElementById('visitor-id').textContent = getVisitorID();

    // 停留时间
    let staySeconds = 0;
    const stayEl = document.getElementById('stay-time');
    function formatTime(s) {
        const m = Math.floor(s / 60), sec = s % 60;
        return (m > 0 ? m + ' 分 ' : '') + sec + ' 秒';
    }
    setInterval(() => {
        staySeconds++;
        stayEl.textContent = formatTime(staySeconds);
    }, 1000);

    // IP 信息
    fetch('https://ipapi.co/json/')
        .then(res => res.json())
        .then(data => {
            document.getElementById('ip').textContent = data.ip;
            document.getElementById('country').textContent = data.country_name;
            document.getElementById('city').textContent = data.city;
            document.getElementById('org').textContent = data.org;
        })
        .catch(() => {
            document.getElementById('ip').textContent = '获取失败';
        });

    // 系统信息
    function getSystemInfo() {
        const ua = navigator.userAgent;
        let os = '未知系统', browser = '未知浏览器', device = /Mobile|Android|iP(hone|od|ad)/.test(ua) ? '移动设备' : '桌面设备';
        if (/Windows NT/.test(ua)) os = 'Windows';
        else if (/Mac OS X/.test(ua)) os = 'macOS';
        else if (/Android/.test(ua)) os = 'Android';
        else if (/iPhone|iPad|iPod/.test(ua)) os = 'iOS';
        else if (/Linux/.test(ua)) os = 'Linux';

        if (/Chrome\/([\d.]+)/.test(ua)) browser = 'Chrome ' + ua.match(/Chrome\/([\d.]+)/)[1];
        else if (/Firefox\/([\d.]+)/.test(ua)) browser = 'Firefox ' + ua.match(/Firefox\/([\d.]+)/)[1];
        else if (/Safari\/([\d.]+)/.test(ua) && !/Chrome/.test(ua)) browser = 'Safari';
        else if (/Edg\/([\d.]+)/.test(ua)) browser = 'Edge ' + ua.match(/Edg\/([\d.]+)/)[1];

        document.getElementById('os').textContent = os;
        document.getElementById('browser').textContent = browser;
        document.getElementById('device').textContent = device;
    }

    getSystemInfo();

    // 当前时间
    function updateTime() {
        const now = new Date();
        document.getElementById('nowtime').textContent = now.toLocaleString();
    }
    updateTime();
    setInterval(updateTime, 1000);
    // 🌟 收起 / 展开控制
    function toggleStats() {
        const statsBox = document.getElementById('site-stats-float');
        statsBox.classList.toggle('hidden');
    }

</script>


<script type="text/javascript">

    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // 启用插件
            thumbnail: <%= theme.lightgallery.thumbnail %>,          // 显示缩略图
            zoom: <%= theme.lightgallery.zoom %>,               // 启用缩放功
            rotate: <%= theme.lightgallery.rotate %>,             // 启用旋转功能能
            autoplay: <%= theme.lightgallery.autoplay %>,        // 启用自动播放功能
            fullScreen: <%= theme.lightgallery.fullScreen %>,      // 启用全屏功能
            pager: <%= theme.lightgallery.pager %>, //页码,
            zoomFromOrigin: true,   // 从原始位置缩放
            actualSize: true,       // 启用查看实际大小的功能
            enableZoomAfter: 300,    // 延迟缩放，确保图片加载完成后可缩放
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // 修复选择器
    }

</script>

<% if(theme.postInfo.viewCount) { %>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<% } %>